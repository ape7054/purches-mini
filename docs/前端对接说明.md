# 采购订单系统 - 前端对接说明

## 📋 项目概述

采购订单系统后端API已开发完成并成功部署上线，支持商品管理、购物车、订单处理和供应商管理等核心功能。本文档旨在帮助前端团队快速理解和对接后端接口。

## 🌐 服务信息

- **API基础地址**: `http://www.ency.asia/v1`
- **服务状态**: ✅ 已上线运行
- **API文档**: `docs/API_接口文档.md`（完整接口说明）
- **数据格式**: JSON
- **字符编码**: UTF-8

## 🚀 快速开始

### 1. 服务验证

在开始开发前，请先验证服务是否正常：

```bash
# 方式1: 浏览器访问
http://www.ency.asia/v1/health

# 方式2: curl命令
curl http://www.ency.asia/v1/health

# 期望返回:
{
  "code": 200,
  "message": "服务正常",
  "data": "OK",
  "timestamp": "2025-09-11T10:30:00.000Z"
}
```

### 2. 获取测试数据

```bash
# 获取商品列表，验证数据接口
curl http://www.ency.asia/v1/products

# 期望返回包含商品列表的JSON数据
```

## 💼 核心业务流程

### 流程1: 商品浏览和搜索
```javascript
// 1. 获取商品列表
GET /v1/products
// 可选参数: page, limit, supplier, search, status

// 2. 获取商品详情
GET /v1/products/{productId}
```

### 流程2: 购物车操作
```javascript
// 1. 查看购物车
GET /v1/cart

// 2. 添加商品到购物车
POST /v1/cart/items
{
  "productId": 1,
  "count": 2
}

// 3. 修改商品数量
PUT /v1/cart/items/{itemId}
{
  "count": 3
}

// 4. 删除商品
DELETE /v1/cart/items/{itemId}

// 5. 清空购物车
DELETE /v1/cart
```

### 流程3: 订单处理
```javascript
// 1. 提交订单（系统自动按供应商分组）
POST /v1/orders
{
  "items": [
    {
      "productId": 1,
      "count": 2
    }
  ],
  "notes": "明天早上8点前送到"
}

// 2. 查看订单列表
GET /v1/orders
// 可选参数: page, limit, supplier, status

// 3. 获取订单详情
GET /v1/orders/{orderId}

// 4. 更新订单状态
PUT /v1/orders/{orderId}/status
{
  "status": "completed",
  "notes": "已完成配送"
}
```

## 📊 响应格式说明

### 成功响应
```json
{
  "code": 200,
  "message": "操作成功",
  "data": {
    // 具体数据内容
  },
  "timestamp": "2025-09-11T10:30:00.000Z"
}
```

### 错误响应
```json
{
  "code": 400,
  "message": "错误描述",
  "data": "详细错误信息",
  "timestamp": "2025-09-11T10:30:00.000Z"
}
```

### 判断请求结果
```javascript
// 前端处理示例
if (response.code === 200) {
  // 成功处理
  console.log('操作成功:', response.data);
} else {
  // 错误处理
  console.error('操作失败:', response.message);
  alert(`错误: ${response.message}`);
}
```

## 🔧 开发注意事项

### 1. 用户认证
- **当前版本**: 使用默认用户ID (user_1)
- **无需处理**: 登录、注册、token验证等
- **所有操作**: 购物车、订单都自动关联到默认用户

### 2. 数据类型
- **价格字段**: 浮点数，保留2位小数 (如: 31.00)
- **时间字段**: ISO 8601格式 (如: 2025-09-11T10:30:00.000Z)
- **ID字段**: 整数类型 (商品ID、购物车项ID)
- **订单ID**: 字符串类型 (如: "ORD202509111030001")

### 3. 分页参数
- **默认页码**: page = 1
- **默认每页**: limit = 50 (商品), limit = 20 (订单)
- **最大每页**: limit ≤ 100

### 4. 状态说明
```javascript
// 商品状态
const PRODUCT_STATUS = {
  AVAILABLE: 'available',      // 可购买
  UNAVAILABLE: 'unavailable',  // 缺货
  DISCONTINUED: 'discontinued'  // 停售
};

// 订单状态
const ORDER_STATUS = {
  PENDING: 'pending',         // 待处理
  CONFIRMED: 'confirmed',     // 已确认
  DELIVERING: 'delivering',   // 配送中
  COMPLETED: 'completed',     // 已完成
  CANCELLED: 'cancelled'      // 已取消
};
```

## 🛠️ 开发调试工具

### 重置测试数据
当需要重新开始测试时：
```bash
POST /v1/reset-data
# 注意：会清空所有数据，重新加载初始测试数据
```

### 导入更多测试数据
```bash
POST /v1/import-products-json
# 从docs/products.json导入商品数据
```

## 📱 前端实现建议

### 1. 页面结构建议
```
├── 商品列表页面 (/products)
│   ├── 搜索筛选
│   ├── 商品卡片
│   └── 分页组件
│
├── 商品详情页面 (/products/:id)
│   ├── 商品信息
│   └── 加入购物车按钮
│
├── 购物车页面 (/cart)
│   ├── 购物车列表
│   ├── 数量修改
│   └── 结算按钮
│
├── 订单列表页面 (/orders)
│   ├── 订单卡片（按供应商分组）
│   ├── 状态筛选
│   └── 订单详情入口
│
└── 订单详情页面 (/orders/:id)
    ├── 订单信息
    └── 状态操作
```

### 2. API调用示例 (JavaScript)
```javascript
// 封装API调用基础方法
const API_BASE = 'http://www.ency.asia/v1';

const apiCall = async (method, endpoint, data = null) => {
  const config = {
    method,
    headers: {
      'Content-Type': 'application/json',
    },
  };
  
  if (data) {
    config.body = JSON.stringify(data);
  }
  
  const response = await fetch(`${API_BASE}${endpoint}`, config);
  return await response.json();
};

// 使用示例
const getProducts = async (page = 1, search = '') => {
  const params = new URLSearchParams({ page, search });
  return await apiCall('GET', `/products?${params}`);
};

const addToCart = async (productId, count) => {
  return await apiCall('POST', '/cart/items', { productId, count });
};

const createOrder = async (items, notes = '') => {
  return await apiCall('POST', '/orders', { items, notes });
};
```

## ❓ 常见问题解决

### Q1: 接口返回404错误
**原因**: 请求路径错误或资源不存在
**解决**: 
- 检查URL路径是否正确（注意 `/v1` 前缀）
- 确认资源ID是否存在

### Q2: 接口返回400错误
**原因**: 请求参数格式错误
**解决**: 
- 检查JSON格式是否正确
- 确认必需参数是否缺失
- 验证参数类型是否匹配

### Q3: 购物车操作失败
**原因**: 商品ID不存在或商品状态异常
**解决**: 
- 先调用 `GET /products/{id}` 确认商品存在
- 检查商品状态是否为 `available`

### Q4: 订单创建失败
**原因**: 购物车为空或商品信息异常
**解决**: 
- 确保购物车中有商品
- 检查商品数量大于0

### Q5: 数据异常，需要重新开始
**解决**: 调用重置接口
```bash
POST /v1/reset-data
```

## 📞 技术支持

### 联系方式
如遇到以下问题请及时沟通：
- ✅ API行为与文档不符
- ✅ 需要调整接口参数或响应格式
- ✅ 需要新增接口功能
- ✅ 性能优化建议
- ✅ 其他技术疑问

### 响应时间
- **工作时间**: 2小时内响应
- **紧急问题**: 随时联系

## 📈 性能建议

1. **分页加载**: 商品列表建议使用分页，避免一次加载过多数据
2. **搜索优化**: 商品搜索建议添加防抖处理
3. **缓存策略**: 商品详情等相对固定的数据可考虑缓存
4. **错误处理**: 建议统一封装错误处理逻辑

## 📋 开发检查清单

开发完成后，请确认以下功能：

### 基础功能
- [ ] 商品列表正常显示
- [ ] 商品搜索和筛选工作正常
- [ ] 商品详情页面正确显示
- [ ] 购物车添加/删除/修改功能正常
- [ ] 订单提交和查看功能正常

### 用户体验
- [ ] 加载状态提示
- [ ] 错误信息友好显示
- [ ] 分页功能正常
- [ ] 空状态页面处理

### 数据验证
- [ ] 数字输入验证（商品数量等）
- [ ] 必填字段验证
- [ ] 数据格式正确性

---

**祝前端团队开发顺利！** 🚀

*文档版本: v1.0*  
*更新时间: 2025年9月11日* 